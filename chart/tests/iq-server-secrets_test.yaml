suite: iq-server-service
templates:
  - iq-server-secrets.yaml
tests:
  - it: renders with defaults
    asserts:
      - hasDocuments:
          count: 3
      - isKind:
          of: Secret
        documentIndex: 0
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 0
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-initial-admin-password-secret
        documentIndex: 0
      - equal:
          path: data.password
          value: YWRtaW4xMjM=
        documentIndex: 0
      - isKind:
          of: Secret
        documentIndex: 1
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 1
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-port-secret
        documentIndex: 1
      - equal:
          path: data.port
          value: NTQzMg==
        documentIndex: 1
      - isKind:
          of: Secret
        documentIndex: 2
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 2
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-username-secret
        documentIndex: 2
      - equal:
          path: data.username
          value: cG9zdGdyZXM=
        documentIndex: 2

  - it: renders with overridden values
    set:
      iq_server:
        initialAdminPassword: "admin!234"
        database:
          hostname: "iq_host"
          port: 54322
          name: "iq_db"
          username: "pg"
          password: "pwd"
    asserts:
      - hasDocuments:
          count: 6
      - isKind:
          of: Secret
        documentIndex: 0
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 0
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-initial-admin-password-secret
        documentIndex: 0
      - equal:
          path: data.password
          value: YWRtaW4hMjM0
        documentIndex: 0
      - isKind:
          of: Secret
        documentIndex: 1
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 1
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-hostname-secret
        documentIndex: 1
      - equal:
          path: data.hostname
          value: aXFfaG9zdA==
        documentIndex: 1
      - isKind:
          of: Secret
        documentIndex: 2
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 2
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-port-secret
        documentIndex: 2
      - equal:
          path: data.port
          value: NTQzMjI=
        documentIndex: 2
      - isKind:
          of: Secret
        documentIndex: 3
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 3
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-name-secret
        documentIndex: 3
      - equal:
          path: data.name
          value: aXFfZGI=
        documentIndex: 3
      - isKind:
          of: Secret
        documentIndex: 4
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 4
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-username-secret
        documentIndex: 4
      - equal:
          path: data.username
          value: cGc=
        documentIndex: 4
      - isKind:
          of: Secret
        documentIndex: 5
      - equal:
          path: apiVersion
          value: v1
        documentIndex: 5
      - equal:
          path: metadata.name
          value: RELEASE-NAME-iq-server-database-password-secret
        documentIndex: 5
      - equal:
          path: data.password
          value: cHdk
        documentIndex: 5
